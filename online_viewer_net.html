<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Boussole GPS DMS</title>
<style>
    body {
        background: radial-gradient(circle, #020617, #000);
        color: #e5e7eb;
        font-family: Arial, sans-serif;
        text-align: center;
    }
    .compass {
        width: 260px;
        height: 260px;
        border: 6px solid #22d3ee;
        border-radius: 50%;
        margin: 30px auto;
        position: relative;
        box-shadow: 0 0 30px #22d3ee;
    }
    .needle {
        width: 4px;
        height: 120px;
        background: red;
        position: absolute;
        top: 10px;
        left: 50%;
        transform-origin: bottom center;
    }
</style>
</head>

<body>

<h1>üß≠ Boussole GPS ‚Äì Mode DMS</h1>

<p>üìç Coordonn√©es cibles :</p>
<p id="target"></p>

<div class="compass">
    <div class="needle" id="needle"></div>
</div>

<p id="info">Initialisation GPS...</p>

<script>
// ----- CONVERSION DMS ‚Üí DECIMAL -----
function dmsToDecimal(deg, min, sec, direction) {
    let dec = deg + min / 60 + sec / 3600;
    if (direction === "S" || direction === "W") dec *= -1;
    return dec;
}

// üëâ COORDONN√âES CIBLES (DMS)
const targetLat = dmsToDecimal(45, 42, 59.44, "N");
const targetLon = dmsToDecimal(4, 53, 41.16, "E");

document.getElementById("target").innerHTML =
    `N 45¬∞ 42' 59.44" <br> E 4¬∞ 53' 41.16"`;

// ----- CALCUL DE L‚ÄôAZIMUT -----
function toRad(deg) {
    return deg * Math.PI / 180;
}

function bearing(lat1, lon1, lat2, lon2) {
    const dLon = toRad(lon2 - lon1);
    lat1 = toRad(lat1);
    lat2 = toRad(lat2);

    const y = Math.sin(dLon) * Math.cos(lat2);
    const x = Math.cos(lat1) * Math.sin(lat2) -
              Math.sin(lat1) * Math.cos(lat2) * Math.cos(dLon);

    return (Math.atan2(y, x) * 180 / Math.PI + 360) % 360;
}

// ----- GPS UTILISATEUR -----
function updateCompass(position) {
    const userLat = position.coords.latitude;
    const userLon = position.coords.longitude;

    const direction = bearing(userLat, userLon, targetLat, targetLon);

    document.getElementById("needle").style.transform =
        `rotate(${direction}deg)`;

    document.getElementById("info").innerHTML =
        `üì° Position actuelle<br>
         Lat: ${userLat.toFixed(5)} | Lon: ${userLon.toFixed(5)}<br>
         üéØ Cap √† suivre : ${direction.toFixed(1)}¬∞`;
}

navigator.geolocation.watchPosition(
    updateCompass,
    () => alert("‚ö†Ô∏è GPS indisponible"),
    { enableHighAccuracy: true }
);
</script>

</body>
</html>